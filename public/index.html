<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Central ‚Äî Login</title>
<style>
/* Enhanced login styling */
.login-card{background:rgba(255,255,255,0.08) !important;border:1px solid rgba(255,255,255,0.15) !important;-webkit-backdrop-filter:blur(20px) !important;backdrop-filter:blur(20px) !important;box-shadow:0 8px 32px 0 rgba(31,38,135,0.2) !important}
</style>
<link rel="icon" type="image/png" href="/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div class="login-wrap">
  <div class="login-card">
    <div class="login-logo">
      <h1>Panel <span>Central</span></h1>
      <p style="color:var(--mt);font-size:.82rem;margin-top:.3rem">Plataforma multi-negocio</p>
    </div>
    <div class="login-tabs">
      <button class="login-tab active" onclick="setTab('login')">Iniciar Sesion</button>
      <button class="login-tab" onclick="setTab('register')">Registrarse</button>
    </div>
    <form id="loginForm" onsubmit="return doLogin(event)">
      <div class="form-group"><label>Email</label><input type="email" id="l-email" required></div>
      <div class="form-group"><label>Password</label><div style="position:relative"><input type="password" id="l-pass" required style="width:100%;padding-right:45px"><button type="button" onclick="togglePassword('l-pass')" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--mt);font-size:1.3rem;padding:0;line-height:1">üëÅÔ∏è</button></div></div>
      <button type="submit" class="btn-primary" id="l-btn">Entrar</button>
    </form>
    <form id="registerForm" style="display:none" onsubmit="return doRegister(event)">
      <div class="form-group"><label>Nombre</label><input type="text" id="r-name" required></div>
      <div class="form-group"><label>Email</label><input type="email" id="r-email" required></div>
      <div class="form-group"><label>Password</label><div style="position:relative"><input type="password" id="r-pass" required minlength="6" style="width:100%;padding-right:45px"><button type="button" onclick="togglePassword('r-pass')" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--mt);font-size:1.3rem;padding:0;line-height:1">üëÅÔ∏è</button></div></div>
      <div class="form-group"><label>Confirmar Password</label><div style="position:relative"><input type="password" id="r-pass2" required style="width:100%;padding-right:45px"><button type="button" onclick="togglePassword('r-pass2')" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--mt);font-size:1.3rem;padding:0;line-height:1">üëÅÔ∏è</button></div></div>
      <button type="submit" class="btn-primary" id="r-btn">Crear Cuenta</button>
    </form>
    <div id="msg" class="login-msg" style="display:none"></div>
  </div>
</div>
<script>
// Si ya tiene token, ir a dashboard
if(localStorage.getItem('token')) window.location.href='/dashboard.html';

let tab='login';
function setTab(t){
  tab=t;
  document.querySelectorAll('.login-tab').forEach((b,i)=>b.classList.toggle('active',i===(t==='login'?0:1)));
  document.getElementById('loginForm').style.display=t==='login'?'block':'none';
  document.getElementById('registerForm').style.display=t==='register'?'block':'none';
  hideMsg();
}
function showMsg(text,type){
  const m=document.getElementById('msg');
  m.style.display='block';m.className='login-msg '+type;m.textContent=text;
}
function hideMsg(){document.getElementById('msg').style.display='none'}
function togglePassword(id){const input=document.getElementById(id);input.type=input.type==='password'?'text':'password'}

async function doLogin(e){
  e.preventDefault();hideMsg();
  const btn=document.getElementById('l-btn');btn.disabled=true;btn.textContent='Entrando...';
  try{
    const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:document.getElementById('l-email').value,password:document.getElementById('l-pass').value})});
    const d=await r.json();
    if(!r.ok) throw new Error(d.error);
    localStorage.setItem('token',d.token);
    localStorage.setItem('user',JSON.stringify(d.user));
    window.location.href='/dashboard.html';
  }catch(err){showMsg(err.message,'error')}
  finally{btn.disabled=false;btn.textContent='Entrar'}
  return false;
}

async function doRegister(e){
  e.preventDefault();hideMsg();
  const pass=document.getElementById('r-pass').value;
  if(pass!==document.getElementById('r-pass2').value){showMsg('Las passwords no coinciden','error');return false}
  const btn=document.getElementById('r-btn');btn.disabled=true;btn.textContent='Creando...';
  try{
    const r=await fetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name:document.getElementById('r-name').value,email:document.getElementById('r-email').value,password:pass})});
    const d=await r.json();
    if(!r.ok) throw new Error(d.error);
    showMsg(d.message,'success');
  }catch(err){showMsg(err.message,'error')}
  finally{btn.disabled=false;btn.textContent='Crear Cuenta'}
  return false;
}
</script>
</body>
</html>
